<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CBS Katman Y√∂netim Sistemi v3.9</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

  <!-- Our modular CSS -->
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
    <div class="main-container">
        <!-- Katman Paneli -->
        <div class="layer-panel">
            <div class="panel-header">
                <h2>
                    <span style="font-size: 18px; color: #ffc107;">üóÇÔ∏è</span>
                    Katmanlar
                    <span id="dbStatus" style="font-size: 10px; margin-left: 8px; padding: 2px 6px; border-radius: 3px; background: #28a745; color: white;" title="Database durumu">DB: ‚úì</span>
                </h2>
                <div class="header-actions">
                    <button class="filter-btn" title="Veritabanƒ±nƒ± Dƒ±≈üa Aktar" data-action="export-database" style="margin-right: 4px;">
                        <span style="font-size: 14px;">üíæ</span>
                    </button>
                    <button class="filter-btn" title="Veritabanƒ±nƒ± ƒ∞√ße Aktar" data-action="import-database" style="margin-right: 4px;">
                        <span style="font-size: 14px;">üì•</span>
                    </button>
                    <button class="filter-btn" title="Filtrele" data-action="toggle-layer-filter">
                        <span style="font-size: 14px;">üîç</span>
                    </button>
                </div>
            </div>
            <input type="file" id="dbImportFile" accept=".sqlite,.db" style="display: none;">

            <!-- Arama ve Filtre -->
            <div class="search-filter-panel" id="searchFilterPanel" style="display: none;">
                <div style="padding: 10px; border-bottom: 1px solid #dee2e6;">
                    <input type="text" id="layerSearch" placeholder="Katman ara..." style="width: 100%; padding: 5px; margin-bottom: 5px;">
                    <!-- Tip se√ßimi kaldƒ±rƒ±ldƒ± -->
                </div>
            </div>
            <!-- Se√ßili Bilgi Paneli -->
            <div class="selected-info-panel" id="selectedInfoPanel" style="display: none; padding: 6px; background: var(--bg-tertiary); border-bottom: 1px solid var(--border-light);">
                <!-- Se√ßili grup/katman bilgisi buraya gelecek -->
            </div>

            <div class="create-buttons">
                <!-- Ana Aksiyon Butonlarƒ± -->
                <div class="primary-actions">
                    <button class="create-group-btn" title="Yeni Grup Olu≈ütur" data-action="show-create-group-modal">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                            <path d="M12 11v6"/>
                            <path d="M9 14h6"/>
                        </svg>
                        Grup Ekle
                    </button>
                    <button class="create-layer-btn" title="Yeni Katman Olu≈ütur" data-action="show-create-layer-modal">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="12" y1="18" x2="12" y2="12"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                        </svg>
                        Katman Ekle
                    </button>
                </div>
                
                <!-- ƒ∞kincil Aksiyon Butonlarƒ± -->
                <div class="secondary-actions">
                    <button class="expand-all-btn" title="T√ºm Gruplarƒ± A√ß" data-action="expand-all-groups">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="7,13 12,18 17,13"/>
                            <polyline points="7,6 12,11 17,6"/>
                        </svg>
                        T√ºm√ºn√º A√ß
                    </button>
                    <button class="collapse-all-btn" title="T√ºm Gruplarƒ± Kapat" data-action="collapse-all-groups">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="17,11 12,6 7,11"/>
                            <polyline points="17,18 12,13 7,18"/>
                        </svg>
                        T√ºm√ºn√º Kapat
                    </button>
                </div>

            </div>
            <div class="layer-list" id="layerList">
                <!-- Temel Harita Grubu -->
                <div class="layer-group" data-group-id="group-1">
                    <div class="group-header">
                        <div class="group-visibility-area" title="T√ºm katmanlarƒ± a√ß/kapat">
                            <input type="checkbox" class="group-visibility-checkbox" checked data-action="toggle-all-layers-in-group">
                        </div>
                        <div class="group-select-area" data-action="select-group">
                            <span class="group-name">Temel Haritalar</span>
                            <span class="group-count">2</span>
                        </div>
                        <div class="group-toggle-area" data-action="toggle-group">
                            <span class="group-icon">‚ñº</span>
                        </div>
                    </div>
                    <div class="group-items">
                        <div class="layer-item" draggable="true" data-layer-id="osm-layer">
                            <input type="checkbox" class="layer-visibility" checked>
                            <div class="layer-selectable-area">
                                <div class="layer-icons">
                                    <div class="layer-icon inactive" title="Bu katmanda nokta veri yok">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <circle cx="12" cy="12" r="6"/>
                                        </svg>
                                    </div>
                                    <div class="layer-icon inactive" title="Bu katmanda √ßizgi veri yok">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M4 12L20 12"/>
                                        </svg>
                                    </div>
                                    <div class="layer-icon active icon-polygon" title="Harita altlƒ±ƒüƒ±">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                                        </svg>
                                    </div>
                                </div>
                                <span class="layer-name">OpenStreetMap</span>
                                <span class="layer-style-mode-indicator default-mode" data-layer-id="osm-layer" title="Stil Modu: Sistem Varsayƒ±lanlarƒ±">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z"/>
                                        <path d="m9 12 2 2 4-4"/>
                                    </svg>
                                </span>
                            </div>
                            <div class="layer-actions">
                                <button class="layer-action-btn" title="√ñzellikler" data-action="show-layer-properties">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                                    </svg>
                                </button>
                                <button class="layer-action-btn" title="Stil Ayarlarƒ±" data-action="open-style-modal">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <circle cx="12" cy="12" r="8"/>
                                    </svg>
                                </button>
                                <button class="layer-action-btn" title="Detaylar" data-action="open-layer-details">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 8V12M12 16H12.01" stroke="white" stroke-width="2"/>
                                    </svg>
                                </button>
                                <button class="layer-action-btn" title="Sil" data-action="delete-layer">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 6L18 18M6 18L18 6"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" draggable="true" data-layer-id="satellite-layer">
                            <input type="checkbox" class="layer-visibility">
                            <div class="layer-selectable-area">
                                <div class="layer-icons">
                                    <div class="layer-icon inactive" title="Bu katmanda nokta veri yok">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <circle cx="12" cy="12" r="6"/>
                                        </svg>
                                    </div>
                                    <div class="layer-icon inactive" title="Bu katmanda √ßizgi veri yok">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M4 12L20 12"/>
                                        </svg>
                                    </div>
                                    <div class="layer-icon active icon-polygon" title="Uydu g√∂r√ºnt√ºs√º">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                                        </svg>
                                    </div>
                                </div>
                                <span class="layer-name">Uydu G√∂r√ºnt√ºs√º</span>
                                <span class="layer-style-mode-indicator default-mode" data-layer-id="satellite-layer" title="Stil Modu: Sistem Varsayƒ±lanlarƒ±">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z"/>
                                        <path d="m9 12 2 2 4-4"/>
                                    </svg>
                                </span>
                            </div>
                            <div class="layer-actions">
                                <button class="layer-action-btn" title="√ñzellikler" data-action="show-layer-properties">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                                    </svg>
                                </button>
                                <button class="layer-action-btn" title="Stil Ayarlarƒ±" data-action="open-style-modal">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <circle cx="12" cy="12" r="8"/>
                                    </svg>
                                </button>
                                <button class="layer-action-btn" title="Detaylar" data-action="open-layer-details">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 8V12M12 16H12.01" stroke="white" stroke-width="2"/>
                                    </svg>
                                </button>
                                <button class="layer-action-btn" title="Sil" data-action="delete-layer">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 6L18 18M6 18L18 6"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Harita Alanƒ± -->
        <div class="map-container">
            <div id="map"></div>
            
            <!-- Status Bar - Koordinat ve √ñl√ßek -->
            <div class="status-bar">
                <div class="status-left">
                    <div class="coordinate-display">
                        <span class="status-label">Koordinat:</span>
                        <div class="coordinate-item" id="coordinateX">X: -</div>
                        <div class="coordinate-item" id="coordinateY">Y: -</div>
                    </div>
                    <div class="scale-display">
                        <span class="status-label">√ñl√ßek:</span>
                        <div class="scale-bar" id="scaleBar"></div>
                        <span class="scale-text" id="scaleText" title="Tek tƒ±k: √∂l√ßek se√ß, √áift tƒ±k: dinamik moda ge√ß" data-action="toggle-scale-selector" data-dblclick="switch-to-dynamic-scale">1:1,000,000</span>
                        <div class="scale-selector" id="scaleSelector">
                            <div class="scale-option" data-action="set-fixed-scale">1:1,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:2,500</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:5,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:10,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:25,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:50,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:100,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:250,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:500,000</div>
                            <div class="scale-option" data-action="set-fixed-scale">1:1,000,000</div>
                            <div class="scale-option" style="border-top: 1px solid #dee2e6; margin-top: 4px; padding-top: 8px;" data-action="set-dynamic-scale">
                                <strong>Dinamik √ñl√ßek</strong>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="status-right">
                    <div class="active-layer-display" id="activeLayerDisplay" style="margin-right: 15px;">
                        <span class="status-label">Aktif Katman:</span>
                        <span id="activeLayerInfo" style="font-weight: 500; color: var(--primary-color);">-</span>
                    </div>
                    <div class="projection-selector">
                        <span class="status-label">Projeksiyon:</span>
                        <select class="projection-select" id="projectionSelect" data-change="change-projection">
                            <option value="EPSG:4326">WGS84 (EPSG:4326)</option>
                            <option value="EPSG:3857">Web Mercator (EPSG:3857)</option>
                            <option value="EPSG:5254">ITRF96 / UTM 35N (EPSG:5254)</option>
                            <option value="EPSG:2320">ED50 / TM30 (EPSG:2320)</option>
                            <option value="EPSG:32635">WGS84 / UTM 35N (EPSG:32635)</option>
                            <option value="EPSG:32636">WGS84 / UTM 36N (EPSG:32636)</option>
                        </select>
                    </div>
                </div>
            </div>



            <!-- Context Menu -->
            <div class="context-menu" id="contextMenu">
                <div class="menu-item" data-action="context-menu-action:zoom">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M15.5,14H20.5L19,15.5L21.5,18L20,19.5L17.5,17L16,18.5V13.5H15.5M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L20,19.29L18.71,20.58L13.15,15C12,15.83 10.61,16.36 9.5,16.36A6.5,6.5 0 0,1 3,9.86A6.5,6.5 0 0,1 9.5,3.36V3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                    </svg>
                    Zoom
                </div>
                <div class="menu-item" data-action="context-menu-action:style">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                    </svg>
                    Stil
                </div>
                <div class="menu-item" data-action="context-menu-action:properties">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    √ñzellikler
                </div>
                <div class="menu-item" data-action="context-menu-action:delete">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                    </svg>
                    Sil
                </div>
            </div>
            
            <!-- Lejant Toggle Butonu - Artƒ±k √ßizim ara√ßlarƒ± ile birlikte -->

            <!-- Lejant Container -->
            <div class="legend-container" id="legendContainer">
                <div class="legend-header" id="legendHeader">
                    <div class="legend-title">Katman Lejantƒ±</div>
                    <div class="legend-controls">
                        <button class="legend-btn" title="Ayarlar" id="legendSettingsBtn" data-action="toggle-legend-settings">‚öô</button>
                        <button class="legend-btn" title="Daralt/Geni≈ület" id="legendCollapseBtn" data-action="toggle-legend-content">‚àí</button>
                        <button class="legend-btn" title="Kapat" data-action="close-legend">√ó</button>
                    </div>
                </div>
                <div class="legend-settings" id="legendSettings" style="display: none;">
                    <div class="legend-setting-item">
                        <input type="checkbox" id="showEmptyLayers" data-change="update-legend-content">
                        <label for="showEmptyLayers">Bo≈ü katmanlarƒ± g√∂ster</label>
                    </div>
                    <div class="legend-setting-item">
                        <input type="checkbox" id="showTypeLabels" data-change="update-legend-content">
                        <label for="showTypeLabels">√áizim tiplerini g√∂ster</label>
                    </div>
                    <div class="legend-setting-item">
                        <input type="checkbox" id="showOnlyVisible" checked data-change="update-legend-content">
                        <label for="showOnlyVisible">Sadece g√∂r√ºn√ºr katmanlarƒ± g√∂ster</label>
                    </div>
                    <div class="legend-setting-item">
                        <input type="checkbox" id="showSelectedOnly" data-change="update-legend-content">
                        <label for="showSelectedOnly">Sadece se√ßili katmanƒ± g√∂ster</label>
                    </div>
                    <div class="legend-setting-item">
                        <label for="legendSymbolSize">Sembol boyutu:</label>
                        <input type="range" id="legendSymbolSize" min="0.5" max="2" step="0.1" value="1" data-change="update-legend-content">
                        <span class="value-display" id="legendSymbolSizeDisplay">1x</span>
                    </div>
                </div>
                <div class="legend-content" id="legendContent">
                    <div id="legendItems">
                        <!-- Lejant √∂ƒüeleri buraya dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>

            <!-- √ñl√ß√ºm Ayarlarƒ± Modalƒ± -->
            <div class="modal" id="measurementSettingsModal">
                <div class="modal-content" style="width: 500px;">
                    <div class="modal-header">
                        <h3>
                            <span style="font-size: 18px; margin-right: 8px;">üìè</span>
                            √ñl√ß√ºm Ayarlarƒ±
                        </h3>
                        <button class="close-btn" data-action="close-measurement-settings">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- Etiket Pozisyonu Ayarlarƒ± -->
                        <div class="style-section">
                            <h4>üìç Etiket Pozisyonu</h4>
                            <div class="control-row">
                                <label>Mesafe Etiketleri:</label>
                                <select id="distanceLabelPosition" data-change="update-measurement-settings">
                                    <option value="center">√áizginin Ortasƒ±</option>
                                    <option value="above">√áizginin √úst√º</option>
                                    <option value="below">√áizginin Altƒ±</option>
                                    <option value="segments">Her Segment √úzerinde</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Alan Etiketleri:</label>
                                <select id="areaLabelPosition" data-change="update-measurement-settings">
                                    <option value="center">Poligonun Ortasƒ±</option>
                                    <option value="centroid">Aƒüƒ±rlƒ±k Merkezi</option>
                                    <option value="bounds">Sƒ±nƒ±r Ortasƒ±</option>
                                </select>
                            </div>
                        </div>

                        <!-- Etiket Sƒ±klƒ±ƒüƒ± Ayarlarƒ± -->
                        <div class="style-section">
                            <h4>üìä Etiket Sƒ±klƒ±ƒüƒ±</h4>
                            <div class="control-row">
                                <label>Segment Etiket Sƒ±klƒ±ƒüƒ±:</label>
                                <input type="range" id="segmentLabelFrequency" min="1" max="10" value="3" data-change="update-measurement-settings">
                                <span class="value-display" id="segmentFrequencyValue">3</span>
                            </div>
                            <div class="control-row">
                                <label>Minimum Segment Uzunluƒüu (m):</label>
                                <input type="range" id="minSegmentLength" min="10" max="1000" value="100" data-change="update-measurement-settings">
                                <span class="value-display" id="minSegmentValue">100</span>
                            </div>
                        </div>

                        <!-- G√∂r√ºn√ºm Ayarlarƒ± -->
                        <div class="style-section">
                            <h4>üé® G√∂r√ºn√ºm</h4>
                            <div class="control-row">
                                <label>Etiket Boyutu:</label>
                                <input type="range" id="labelSize" min="8" max="18" value="12" data-change="update-measurement-settings">
                                <span class="value-display" id="labelSizeValue">12px</span>
                            </div>
                            <div class="control-row">
                                <label>Etiket Arka Plan:</label>
                                <input type="checkbox" id="labelBackground" checked data-change="update-measurement-settings">
                                <span style="margin-left: 10px;">Arka plan g√∂ster</span>
                            </div>
                            <div class="control-row">
                                <label>Etiket Rengi:</label>
                                <input type="color" id="labelColor" value="#ffffff" data-change="update-measurement-settings">
                            </div>
                            <div class="control-row">
                                <label>Arka Plan Rengi:</label>
                                <input type="color" id="labelBackgroundColor" value="#000000" data-change="update-measurement-settings">
                            </div>
                        </div>

                        <!-- Birim Ayarlarƒ± -->
                        <div class="style-section">
                            <h4>üìê Birimler</h4>
                            <div class="control-row">
                                <label>Mesafe Birimi:</label>
                                <select id="distanceUnit" data-change="update-measurement-settings">
                                    <option value="auto">Otomatik (m/km)</option>
                                    <option value="m">Metre (m)</option>
                                    <option value="km">Kilometre (km)</option>
                                    <option value="ft">Feet (ft)</option>
                                    <option value="mi">Mil (mi)</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Alan Birimi:</label>
                                <select id="areaUnit" data-change="update-measurement-settings">
                                    <option value="auto">Otomatik (m¬≤/ha)</option>
                                    <option value="m2">Metrekare (m¬≤)</option>
                                    <option value="ha">Hektar (ha)</option>
                                    <option value="km2">Kilometrekare (km¬≤)</option>
                                    <option value="ac">Acre (ac)</option>
                                </select>
                            </div>
                        </div>

                        <!-- √ñzel Ayarlar -->
                        <div class="style-section">
                            <h4>‚ö° √ñzel Ayarlar</h4>
                            <div class="control-row">
                                <label>Anlƒ±k G√ºncelleme:</label>
                                <input type="checkbox" id="liveUpdate" checked data-change="update-measurement-settings">
                                <span style="margin-left: 10px;">√áizim sƒ±rasƒ±nda etiketleri g√ºncelle</span>
                            </div>
                            <div class="control-row">
                                <label>Toplam Mesafe:</label>
                                <input type="checkbox" id="showTotal" checked data-change="update-measurement-settings">
                                <span style="margin-left: 10px;">Toplam mesafeyi g√∂ster</span>
                            </div>
                            <div class="control-row">
                                <label>Kƒ±smi Mesafeler:</label>
                                <input type="checkbox" id="showPartial" data-change="update-measurement-settings">
                                <span style="margin-left: 10px;">Her segment mesafesini g√∂ster</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-action="reset-measurement-settings">Varsayƒ±lan</button>
                        <button class="btn btn-primary" data-action="close-measurement-settings">Tamam</button>
                    </div>
                </div>
            </div>

            <!-- Mesaj Konsolu -->
            <div class="message-console" id="messageConsole">
                <div class="console-header">
                    <div class="console-title">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
                            <path d="M19,3H5C3.9,3 3,3.9 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.9 20.1,3 19,3Z"/>
                            <path d="M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z"/>
                        </svg>
                        Mesaj Konsolu
                        <span class="message-counter" id="messageCounter">0</span>
                    </div>
                                         <div class="console-controls">
                         <button class="console-btn" title="Alt bara kilitle/Serbest bƒ±rak" id="dockBtn" data-action="toggle-console-dock">
                             <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                 <path d="M16,20H20V16H16M16,14H20V10H16M4,8V4H8V8M10,20H14V16H10M16,8V4H20V8M4,20H8V16H4M4,14H8V10H4M10,8V4H14V8M10,14H14V10H10V14Z"/>
                             </svg>
                         </button>
                         <button class="console-btn" title="Temizle" data-action="clear-message-console">
                             <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                 <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                             </svg>
                         </button>
                         <button class="console-btn" title="Daralt/Geni≈ület" id="consoleMinimizeBtn" data-action="toggle-console-minimize">‚àí</button>
                         <button class="console-btn" title="Kapat" data-action="toggle-message-console">√ó</button>
                     </div>
                </div>
                <div class="console-filters">
                    <label class="filter-label">
                        <input type="checkbox" id="showInfoMessages" checked data-change="filter-messages">
                        <span class="filter-badge info">Info</span>
                    </label>
                    <label class="filter-label">
                        <input type="checkbox" id="showSuccessMessages" checked data-change="filter-messages">
                        <span class="filter-badge success">Success</span>
                    </label>
                    <label class="filter-label">
                        <input type="checkbox" id="showWarningMessages" checked data-change="filter-messages">
                        <span class="filter-badge warning">Warning</span>
                    </label>
                    <label class="filter-label">
                        <input type="checkbox" id="showErrorMessages" checked data-change="filter-messages">
                        <span class="filter-badge error">Error</span>
                    </label>
                </div>
                <div class="console-content" id="consoleContent">
                    <div class="console-messages" id="consoleMessages">
                        <!-- Mesajlar buraya dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>

            <!-- Birle≈üik Ara√ß Kontrolleri -->
            <div class="map-tools-container">
                <!-- √ñl√ß√ºm Ara√ßlarƒ± -->
                <div class="tool-group">
                    <div class="tool-group-title">√ñl√ß√ºm</div>
                    <div class="tool-buttons">
                        <button class="tool-btn" title="Mesafe √ñl√ß" id="distanceBtn" data-action="start-measurement:distance">
                            <span style="font-size: 16px; color: #2ecc71;">üìè</span>
                        </button>
                        <button class="tool-btn" title="Alan √ñl√ß" id="areaBtn" data-action="start-measurement:area">
                            <span style="font-size: 16px; color: #3498db;">‚¨ü</span>
                        </button>
                        <button class="tool-btn" title="√ñl√ß√ºmleri Temizle" data-action="clear-measurements">
                            <span style="font-size: 16px; color: #e74c3c;">üóëÔ∏è</span>
                        </button>
                        <button class="tool-btn" title="√ñl√ß√ºm Ayarlarƒ±" data-action="open-measurement-settings">
                            <span style="font-size: 16px; color: #9b59b6;">‚öôÔ∏è</span>
                        </button>
                    </div>
                </div>
                
                <!-- √áizim Ara√ßlarƒ± -->
                <div class="tool-group">
                    <div class="tool-group-title">√áizim</div>
                    <div class="tool-buttons">
                        <button class="tool-btn" title="Nokta √áiz" id="pointBtn" data-action="start-drawing:marker">
                            <span style="font-size: 16px; color: #e74c3c;">üìç</span>
                        </button>
                        <button class="tool-btn" title="√áizgi √áiz" id="lineBtn" data-action="start-drawing:polyline">
                            <span style="font-size: 16px; color: #f39c12;">üìè</span>
                        </button>
                        <button class="tool-btn" title="Poligon √áiz" id="polygonBtn" data-action="start-drawing:polygon">
                            <span style="font-size: 16px; color: #3498db;">‚¨ü</span>
                        </button>
                        <button class="tool-btn" title="Dikd√∂rtgen √áiz" id="rectangleBtn" data-action="start-drawing:rectangle">
                            <span style="font-size: 16px; color: #9b59b6;">‚¨ú</span>
                        </button>
                        <button class="tool-btn" title="Daire √áiz" id="circleBtn" data-action="start-drawing:circle">
                            <span style="font-size: 16px; color: #e67e22;">‚≠ï</span>
                        </button>
                    </div>
                </div>
                
                <!-- D√ºzenleme Ara√ßlarƒ± -->
                <div class="tool-group">
                    <div class="tool-group-title">D√ºzenleme</div>
                    <div class="tool-buttons">
                        <button class="tool-btn" title="D√ºzenle" id="editBtn" data-action="toggle-edit-mode">
                            <span style="font-size: 16px; color: #9b59b6;">‚úèÔ∏è</span>
                        </button>
                        <button class="tool-btn" title="Sil" id="deleteBtn" data-action="toggle-delete-mode">
                            <span style="font-size: 16px; color: #e74c3c;">üóëÔ∏è</span>
                        </button>
                    </div>
                </div>
                
                <!-- G√∂r√ºn√ºm Ara√ßlarƒ± -->
                <div class="tool-group">
                    <div class="tool-group-title">G√∂r√ºn√ºm</div>
                    <div class="tool-buttons">
                        <button class="tool-btn" title="Lejant A√ß/Kapat" id="legendBtn" data-action="toggle-legend">
                            <span style="font-size: 16px; color: #7f8c8d;">üìã</span>
                        </button>
                        <button class="tool-btn" title="T√ºm√ºne Zoom" id="zoomExtentBtn" data-action="zoom-to-extent">
                            <span style="font-size: 16px; color: #2ecc71;">üîç</span>
                        </button>
                        <button class="tool-btn" title="Tam Ekran" id="fullscreenBtn" data-action="toggle-fullscreen">
                            <span style="font-size: 16px; color: #34495e;">‚õ∂</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast" id="toast"></div>

    <!-- Grup/Katman Olu≈üturma Modal -->
    <div class="modal" id="createModal">
        <div class="modal-content" style="width: 400px;">
            <div class="modal-header">
                <h3 id="createModalTitle">Yeni Olu≈ütur</h3>
                <button class="close-btn" data-action="close-create-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="style-section">
                    <h4 id="createModalSubtitle">Ad</h4>
                    <div class="control-row">
                        <input type="text" id="createNameInput" placeholder="Ad giriniz..." style="width: 100%; padding: 10px; border: 2px solid #2196f3; border-radius: 4px; font-size: 14px;">
                    </div>
                    <div class="control-row" id="groupSelectRow" style="display: none; margin-top: 10px;">
                        <label>Hedef Grup:</label>
                        <select id="targetGroupSelect" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="close-create-modal">ƒ∞ptal</button>
                <button class="btn btn-primary" id="createModalConfirm" data-action="confirm-create">Olu≈ütur</button>
            </div>
        </div>
    </div>

    <!-- Stil Ayarlarƒ± Modal -->
    <div class="modal" id="styleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Stil Ayarlarƒ±</h3>
                <button class="close-btn" data-action="close-style-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Ayar Modu Se√ßici -->
                <div class="style-section" style="border-bottom: 2px solid #dee2e6; margin-bottom: 15px; padding-bottom: 10px;">
                    <div class="control-row">
                        <label style="font-weight: 600; color: #495057;">Ayar Modu:</label>
                        <div style="display: flex; gap: 10px; flex: 1; align-items: center;">
                            <select id="styleMode" style="flex: 1; padding: 5px; border: 1px solid #ced4da; border-radius: 4px;">
                                <option value="default">Varsayƒ±lan Deƒüerler</option>
                                <option value="custom">Kullanƒ±cƒ± √ñzel Ayarlarƒ±</option>
                            </select>
                            <button id="styleModeToggle" 
                                    class="style-mode-toggle" 
 
                                    title="Stil Modunu Deƒüi≈ütir">
                                <span id="styleModeIcon">üè¢</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="style-tabs">
                    <button class="style-tab active" data-action="switch-tab:style">Stil</button>
                    <button class="style-tab" data-action="switch-tab:label">Etiket</button>
                    <button class="style-tab" data-action="switch-tab:theme">Tema</button>
                </div>

                <div id="styleContent">
                    <!-- Nokta Stili -->
                    <div class="style-section" id="pointStyle">
                        <h4>Nokta G√∂r√ºn√ºm√º</h4>
                        <div class="control-row">
                            <label>Stil Tipi:</label>
                            <select id="pointStyleType">
                                <option value="custom">√ñzel Tasarƒ±m</option>
                                <option value="icon">Hazƒ±r ƒ∞kon</option>
                            </select>
                        </div>
                        
                        <!-- √ñzel Tasarƒ±m Se√ßenekleri -->
                        <div id="customPointOptions">
                            <div class="control-row">
                                <label>Renk:</label>
                                <input type="color" id="pointColor" value="#ff0000">
                            </div>
                            <div class="control-row">
                                <label>Boyut:</label>
                                <input type="range" id="pointSize" min="4" max="20" value="8">
                                <span class="value-display">8px</span>
                            </div>
                            <div class="control-row">
                                <label>≈ûekil:</label>
                                <select id="pointShape">
                                    <option value="circle">Daire</option>
                                    <option value="square">Kare</option>
                                    <option value="triangle">√ú√ßgen</option>
                                    <option value="star">Yƒ±ldƒ±z</option>
                                    <option value="diamond">Elmas</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Saydamlƒ±k:</label>
                                <input type="range" id="pointOpacity" min="0" max="100" value="100">
                                <span class="value-display">100%</span>
                            </div>
                        </div>
                        
                        <!-- Hazƒ±r ƒ∞kon Se√ßenekleri -->
                        <div id="iconPointOptions" style="display: none;">
                            <div class="control-row">
                                <label>ƒ∞kon Kategorisi:</label>
                                <select id="iconCategory">
                                    <option value="location">Konum</option>
                                    <option value="transport">Ula≈üƒ±m</option>
                                    <option value="service">Hizmet</option>
                                    <option value="nature">Doƒüa</option>
                                    <option value="building">Yapƒ±</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>ƒ∞kon Se√ßimi:</label>
                                <div class="icon-grid" id="iconGrid">
                                    <!-- ƒ∞konlar dinamik olarak buraya eklenecek -->
                                </div>
                            </div>
                            <div class="control-row">
                                <label>ƒ∞kon Boyutu:</label>
                                <input type="range" id="iconSize" min="16" max="48" value="24">
                                <span class="value-display">24px</span>
                            </div>
                        </div>
                    </div>

                    <!-- √áizgi Stili -->
                    <div class="style-section" id="lineStyle">
                        <h4>√áizgi G√∂r√ºn√ºm√º</h4>
                        <div class="control-row">
                            <label>Renk:</label>
                            <input type="color" id="lineColor" value="#ff7800">
                        </div>
                        <div class="control-row">
                            <label>Kalƒ±nlƒ±k:</label>
                            <input type="range" id="lineWidth" min="1" max="10" value="3">
                            <span class="value-display">3px</span>
                        </div>
                        <div class="control-row">
                            <label>Saydamlƒ±k:</label>
                            <input type="range" id="lineOpacity" min="0" max="100" value="100">
                            <span class="value-display">100%</span>
                        </div>
                        <div class="control-row">
                            <label>√áizgi Tipi:</label>
                            <select id="lineType">
                                <option value="solid">D√ºz</option>
                                <option value="dashed">Kesikli</option>
                                <option value="dotted">Noktalƒ±</option>
                                <option value="dashDot">Kesik-Nokta</option>
                            </select>
                        </div>
                    </div>

                    <!-- Poligon Stili -->
                    <div class="style-section" id="polygonStyle">
                        <h4>Poligon G√∂r√ºn√ºm√º</h4>
                        <div class="control-row">
                            <label>Dolgu Rengi:</label>
                            <input type="color" id="fillColor" value="#3388ff">
                        </div>
                        <div class="control-row">
                            <label>Dolgu Saydamlƒ±k:</label>
                            <input type="range" id="fillOpacity" min="0" max="100" value="50">
                            <span class="value-display">50%</span>
                        </div>
                        <div class="control-row">
                            <label>Kenar Rengi:</label>
                            <input type="color" id="strokeColor" value="#000000">
                        </div>
                        <div class="control-row">
                            <label>Kenar Kalƒ±nlƒ±ƒüƒ±:</label>
                            <input type="range" id="strokeWidth" min="0" max="5" value="1">
                            <span class="value-display">1px</span>
                        </div>
                        <div class="control-row">
                            <label>Kenar Saydamlƒ±k:</label>
                            <input type="range" id="strokeOpacity" min="0" max="100" value="100">
                            <span class="value-display">100%</span>
                        </div>
                        <div class="control-row">
                            <label>Kenar Tipi:</label>
                            <select id="strokeType">
                                <option value="solid">D√ºz</option>
                                <option value="dashed">Kesikli</option>
                                <option value="dotted">Noktalƒ±</option>
                            </select>
                        </div>
                    </div>
                    
                    
                </div>

                <div id="labelContent" style="display: none;">
                    <div class="style-section">
                        <h4>Etiket Ayarlarƒ±</h4>
                        <div class="control-row">
                            <label>Etiket G√∂ster:</label>
                            <input type="checkbox" id="showLabels" style="margin-left: 10px;">
                        </div>
                        <div class="control-row">
                            <label>Etiket Alanƒ±:</label>
                            <select id="labelField">
                                <option value="">Se√ßiniz</option>
                                <option value="name">ƒ∞sim</option>
                                <option value="id">ID</option>
                                <option value="type">Tip</option>
                                <option value="area">Alan (m¬≤)</option>
                                <option value="length">Uzunluk (m)</option>
                            </select>
                        </div>
                        <div class="control-row">
                            <label>Font Boyutu:</label>
                            <input type="range" id="fontSize" min="8" max="24" value="12">
                            <span class="value-display">12px</span>
                        </div>
                        <div class="control-row">
                            <label>Font Rengi:</label>
                            <input type="color" id="fontColor" value="#000000">
                        </div>
                        <div class="control-row">
                            <label>Halo Rengi:</label>
                            <input type="color" id="haloColor" value="#ffffff">
                        </div>
                        <div class="control-row">
                            <label>Halo Kalƒ±nlƒ±ƒüƒ±:</label>
                            <input type="range" id="haloWidth" min="0" max="5" value="1">
                            <span class="value-display">1px</span>
                        </div>
                        <div class="control-row">
                            <label>Etiket Konumu:</label>
                            <select id="labelPosition">
                                <option value="center">Merkez</option>
                                <option value="top">√úst</option>
                                <option value="bottom">Alt</option>
                                <option value="left">Sol</option>
                                <option value="right">Saƒü</option>
                            </select>
                        </div>
                        <div class="control-row">
                            <button class="btn btn-secondary" style="margin-top: 10px;" data-action="assign-field-values">
                                üìä Se√ßili Alana Deƒüer Ata
                            </button>
                            <small style="color: #6c757d; display: block; margin-top: 5px;">
                                Yukarƒ±daki "Etiket Alanƒ±"na g√∂re otomatik deƒüer atar
                            </small>
                        </div>
                    </div>
                </div>

                <div id="themeContent" style="display: none;">
                    <div class="style-section">
                        <h4>üé® Symbology (Semboloji)</h4>

                        <!-- Symbology Mode Selector -->
                        <div class="control-row">
                            <label style="font-weight: 600;">Sembol Tipi:</label>
                            <select id="symbologyMode" style="width: 100%;" data-change="on-symbology-mode-change">
                                <option value="single">Tek Sembol (Single Symbol)</option>
                                <option value="categorized">Kategorik (Categorized)</option>
                                <option value="graduated">Deƒüer Aralƒ±klarƒ± (Graduated)</option>
                                <option value="heatmap">üî• Isƒ± Haritasƒ± (Heatmap)</option>
                            </select>
                        </div>

                        <!-- Single Symbol Options -->
                        <div id="singleSymbolOptions" class="symbology-options">
                            <p style="color: #666; font-size: 12px; margin: 10px 0;">T√ºm √∂zellikler aynƒ± stilde g√∂sterilir. Stil sekmesinden g√∂r√ºn√ºm ayarlarƒ±nƒ± yapabilirsiniz.</p>
                        </div>

                        <!-- Categorized Options -->
                        <div id="categorizedOptions" class="symbology-options" style="display: none;">
                            <div class="control-row">
                                <label>Kategori Alanƒ±:</label>
                                <select id="categoryField" data-change="update-category-preview">
                                    <option value="">Se√ßiniz</option>
                                    <option value="category">Kategori</option>
                                    <option value="type">Tip</option>
                                    <option value="name">ƒ∞sim</option>
                                </select>
                            </div>

                            <div class="control-row">
                                <label>Renk Paleti:</label>
                                <select id="categoricalColorRamp" data-change="update-category-preview">
                                    <option value="Set1">Set1 (9 renk)</option>
                                    <option value="Set2">Set2 (8 renk)</option>
                                    <option value="Set3">Set3 (12 renk)</option>
                                    <option value="Pastel1">Pastel1 (9 renk)</option>
                                    <option value="Pastel2">Pastel2 (8 renk)</option>
                                    <option value="Dark2">Dark2 (8 renk)</option>
                                    <option value="Accent">Accent (8 renk)</option>
                                    <option value="Paired">Paired (12 renk)</option>
                                </select>
                            </div>

                            <div id="categoryPreview" class="color-ramp-preview">
                                <!-- Color preview will be inserted here -->
                            </div>

                            <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" data-action="apply-categorized-style">
                                ‚ú® Kategorik Stili Uygula
                            </button>
                        </div>

                        <!-- Graduated Options -->
                        <div id="graduatedOptions" class="symbology-options" style="display: none;">
                            <div class="control-row">
                                <label>Deƒüer Alanƒ±:</label>
                                <select id="valueField" data-change="update-graduated-preview">
                                    <option value="">Se√ßiniz</option>
                                    <option value="value">Deƒüer</option>
                                    <option value="population">N√ºfus</option>
                                    <option value="area">Alan</option>
                                    <option value="density">Yoƒüunluk</option>
                                    <option value="temperature">Sƒ±caklƒ±k</option>
                                </select>
                            </div>

                            <div class="control-row">
                                <label>Sƒ±nƒ±flandƒ±rma:</label>
                                <select id="classificationMethod" data-change="update-graduated-preview">
                                    <option value="quantile">Quantile (E≈üit Sayƒ±da)</option>
                                    <option value="equal">Equal Interval (E≈üit Aralƒ±k)</option>
                                    <option value="natural">Natural Breaks (Jenks)</option>
                                    <option value="manual">Manuel</option>
                                </select>
                            </div>

                            <div class="control-row">
                                <label>Sƒ±nƒ±f Sayƒ±sƒ±:</label>
                                <input type="range" id="numClasses" min="3" max="9" value="5" data-input="update-graduated-preview">
                                <span class="value-display">5</span>
                            </div>

                            <div class="control-row">
                                <label>Renk Tipi:</label>
                                <select id="colorRampType" data-change="update-color-ramp-list">
                                    <option value="sequential">Sequential (Ardƒ±≈üƒ±k)</option>
                                    <option value="diverging">Diverging (Ayrƒ±lan)</option>
                                    <option value="heatmap">Heatmap (Isƒ± Haritasƒ±)</option>
                                </select>
                            </div>

                            <div class="control-row">
                                <label>Renk Paleti:</label>
                                <select id="colorRampName" data-change="update-graduated-preview">
                                    <!-- Options will be populated by updateColorRampList() -->
                                </select>
                            </div>

                            <div id="graduatedPreview" class="color-ramp-preview">
                                <!-- Color ramp preview will be inserted here -->
                            </div>

                            <div class="control-row" style="margin-top: 10px;">
                                <label>
                                    <input type="checkbox" id="invertColorRamp" data-change="update-graduated-preview">
                                    Renkleri Ters √áevir
                                </label>
                            </div>

                            <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" data-action="apply-graduated-style">
                                üìä Graduated Stili Uygula
                            </button>
                        </div>

                        <!-- Heatmap Options -->
                        <div id="heatmapOptions" class="symbology-options" style="display: none;">
                            <p style="color: #666; font-size: 13px; margin: 10px 0;">
                                Isƒ± haritasƒ± sadece <strong>nokta (point)</strong> √∂zellikleri i√ßin √ßalƒ±≈üƒ±r ve <strong>value</strong> alanƒ±nƒ± kullanƒ±r.
                            </p>

                            <div class="control-row">
                                <label>Yarƒ±√ßap:</label>
                                <input type="range" id="heatmapRadius" min="10" max="100" value="60">
                                <span class="value-display">60px</span>
                            </div>

                            <div class="control-row">
                                <label>Bulanƒ±klƒ±k:</label>
                                <input type="range" id="heatmapBlur" min="5" max="50" value="40">
                                <span class="value-display">40px</span>
                            </div>

                            <div class="control-row" style="margin-top: 15px;">
                                <button class="btn btn-primary" style="width: 100%;" data-action="apply-heatmap-visualization">
                                    üî• Isƒ± Haritasƒ± G√∂ster
                                </button>
                            </div>

                            <div class="control-row" style="margin-top: 10px;">
                                <button class="btn btn-secondary" style="width: 100%;" data-action="remove-heatmap-visualization">
                                    ‚ùå Isƒ± Haritasƒ±nƒ± Kaldƒ±r
                                </button>
                            </div>

                            <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-top: 15px; font-size: 12px;">
                                <strong>üí° Kullanƒ±m:</strong>
                                <ol style="margin: 5px 0 0 15px; padding: 0;">
                                    <li>Nokta √ßizin</li>
                                    <li>Saƒü tƒ±klayƒ±p "√ñzellikleri D√ºzenle"</li>
                                    <li>"Deƒüer" alanƒ±na sayƒ± girin</li>
                                    <li>"Isƒ± Haritasƒ± G√∂ster" butonuna tƒ±klayƒ±n</li>
                                </ol>
                            </div>
                        </div>

                        <!-- Legend Preview -->
                        <div id="legendPreview" class="legend-preview" style="margin-top: 15px; display: none;">
                            <h5 style="margin: 0 0 10px 0; font-size: 13px;">Lejant √ñnizlemesi:</h5>
                            <div id="legendContent"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="close-style-modal">ƒ∞ptal</button>
                <button class="btn btn-primary" data-action="save-and-close-style">Kaydet & Kapat</button>
            </div>
        </div>
    </div>

    <!-- Sorgu Modal -->
    <div class="modal" id="queryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Sorgu</h3>
                <button class="close-btn" data-action="close-query-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="style-tabs">
                    <button class="style-tab active" data-action="switch-query-tab:basic">Temel</button>
                    <button class="style-tab" data-action="switch-query-tab:advanced">Geli≈ümi≈ü</button>
                </div>
                
                <div id="basicQueryContent">
                    <div class="style-section">
                        <h4>Temel Sorgu</h4>
                        <div class="control-row">
                            <label>Alan:</label>
                            <select id="queryField">
                                <option value="">Se√ßiniz</option>
                                <option value="name">Ad</option>
                                <option value="type">Tip</option>
                                <option value="area">Alan</option>
                                <option value="population">N√ºfus</option>
                            </select>
                        </div>
                        <div class="control-row">
                            <label>Operat√∂r:</label>
                            <select id="queryOperator">
                                <option value="equals">E≈üittir</option>
                                <option value="notEquals">E≈üit Deƒüildir</option>
                                <option value="contains">ƒ∞√ßerir</option>
                                <option value="startsWith">ƒ∞le Ba≈ülar</option>
                                <option value="endsWith">ƒ∞le Biter</option>
                                <option value="greaterThan">B√ºy√ºkt√ºr</option>
                                <option value="lessThan">K√º√ß√ºkt√ºr</option>
                            </select>
                        </div>
                        <div class="control-row">
                            <label>Deƒüer:</label>
                            <input type="text" id="queryValue" placeholder="Deƒüer giriniz">
                        </div>
                    </div>
                </div>
                
                <div id="advancedQueryContent" style="display: none;">
                    <div class="style-section">
                        <h4>Geli≈ümi≈ü Sorgu</h4>
                        <div class="control-row">
                            <label>SQL ƒ∞fadesi:</label>
                        </div>
                        <div class="control-row">
                            <textarea id="sqlQuery" rows="5" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-family: monospace;" placeholder="√ñrnek: alan > 1000 AND tip = 'Konut'"></textarea>
                        </div>
                        <div class="control-row">
                            <small style="color: #6c757d;">Desteklenen operat√∂rler: AND, OR, =, !=, &gt;, &lt;, &gt;=, &lt;=, LIKE</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="close-query-modal">ƒ∞ptal</button>
                <button class="btn btn-primary" data-action="apply-query">Sorgula</button>
            </div>
        </div>
    </div>

    <!-- Katman Detaylarƒ± Modal -->
    <div class="layer-details-modal" id="layerDetailsModal">
        <div class="layer-details-content">
            <div class="layer-details-header">
                <h3>Katman Detaylarƒ±: <span id="layerDetailName"></span></h3>
                <button class="close-btn" data-action="close-layer-details-modal">&times;</button>
            </div>
            <div class="layer-details-body">
                <div id="featuresContainer">
                    <!-- √áizim detaylarƒ± burada listelenecek -->
                </div>
            </div>
            <div class="layer-details-footer">
                <button class="btn btn-secondary" data-action="close-layer-details-modal">Kapat</button>
                <button class="btn btn-primary" data-action="add-feature-to-layer">Yeni √áizim Ekle</button>
            </div>
        </div>
    </div>

    <!-- Attribute Editor Modal -->
    <div class="modal" id="attributeEditorModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>ü§ñ Otomatik Deƒüer Atama</h3>
                <button class="close-btn" data-action="close-attribute-editor">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- A√ßƒ±klama -->
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                    <p style="margin: 0; color: #2e7d32; font-size: 14px;">
                        <strong>üí° Bilgi:</strong> Se√ßili katmandaki <strong>t√ºm √∂zelliklere</strong> (nokta, √ßizgi, poligon)
                        otomatik olarak deƒüer atanacaktƒ±r. Atama t√ºr√ºn√º se√ßip butona tƒ±klayƒ±n.
                    </p>
                </div>

                <!-- Alan T√ºr√º Se√ßimi -->
                <div class="control-row" style="margin-bottom: 20px;">
                    <label style="font-weight: 600; min-width: 120px;">Atama T√ºr√º:</label>
                    <select id="autoAssignField" style="flex: 1; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                        <option value="">Se√ßiniz...</option>
                        <option value="name">üìù ƒ∞sim (Nokta-1, √áizgi-1, Poligon-1)</option>
                        <option value="value">üî¢ Deƒüer (1, 2, 3, 4, ...)</option>
                        <option value="category">üè∑Ô∏è Kategori (Point, Line, Polygon)</option>
                        <option value="sequential">üÜî Sƒ±ralƒ± ID (F-001, F-002, F-003)</option>
                    </select>
                </div>

                <!-- Se√ßeneklerin A√ßƒ±klamalarƒ± -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 13px; color: #495057;">üìã Atama T√ºr√º A√ßƒ±klamalarƒ±:</h4>
                    <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: #6c757d;">
                        <li><strong>ƒ∞sim:</strong> Geometri tipine g√∂re isimlendirme (Nokta-1, Nokta-2, √áizgi-1, vb.)</li>
                        <li><strong>Deƒüer:</strong> Sƒ±ralƒ± sayƒ±sal deƒüerler - Isƒ± haritasƒ± ve graduated stil i√ßin</li>
                        <li><strong>Kategori:</strong> Geometri tipi kategorileri - Kategorik stil i√ßin</li>
                        <li><strong>Sƒ±ralƒ± ID:</strong> Formatlƒ± ID ve isim (F-001: Feature 001)</li>
                    </ul>
                </div>

                <!-- √ñrnek Sonu√ßlar -->
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                    <h4 style="margin: 0 0 10px 0; font-size: 13px; color: #856404;">üéØ √ñrnek Sonu√ßlar:</h4>
                    <div style="font-size: 12px; color: #856404; font-family: monospace;">
                        <div><strong>ƒ∞sim:</strong> name: "Nokta-1", "Nokta-2", "√áizgi-1", "Poligon-1"</div>
                        <div><strong>Deƒüer:</strong> value: 1, 2, 3, 4, 5...</div>
                        <div><strong>Kategori:</strong> category: "Point", "Line", "Polygon"</div>
                        <div><strong>Sƒ±ralƒ± ID:</strong> id: "F-001", name: "Feature 001"</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="close-attribute-editor">ƒ∞ptal</button>
                <button class="btn btn-primary" data-action="auto-assign-values" style="padding: 10px 30px; font-size: 15px;">
                    ‚ö° Otomatik Ata
                </button>
            </div>
        </div>
    </div>

    <!-- Context Menu (Saƒü Tƒ±k Men√ºs√º) -->
    <div id="contextMenu" style="display: none; position: absolute; z-index: 10000; background: white; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); min-width: 150px;">
        <div class="context-menu-item" style="padding: 10px; cursor: pointer; border-bottom: 1px solid #eee;" data-action="edit-feature-attributes">
            üìù √ñzellikleri D√ºzenle
        </div>
        <div class="context-menu-item" style="padding: 10px; cursor: pointer; color: #dc3545;" data-action="delete-feature-from-context">
            üóëÔ∏è Sil
        </div>
    </div>


  <!-- External dependencies - Load before our module -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script defer src="https://unpkg.com/proj4@2.9.2/dist/proj4.js"></script>
  <script defer src="https://unpkg.com/proj4leaflet@1.0.2/dist/proj4leaflet.js"></script>
  <script defer src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script defer src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

  <!-- Our modular JavaScript - Loads after external libraries -->
  <script type="module" defer src="/main.js"></script>
</body>
</html>
