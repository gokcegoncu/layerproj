<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple App Test</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="/styles/main.css">

  <style>
    #console {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 10000;
      border: 2px solid #00ff00;
    }
    .log { margin: 2px 0; }
    .error { color: #ff0000; }
  </style>
</head>
<body>
    <div id="console"></div>
    <div class="main-container">
        <div class="layer-panel">
            <div class="panel-header">
                <h2>üó∫Ô∏è Simple Test (No Database)</h2>
            </div>
            <div class="create-buttons">
                <button onclick="testMap()">Test Map</button>
                <button onclick="testDrawing()">Test Drawing</button>
            </div>
        </div>

        <div class="toolbar">
            <div class="tool-group">
                <button id="markerBtn" class="tool-btn" title="Nokta">üìç</button>
                <button id="polylineBtn" class="tool-btn" title="√áizgi">üìè</button>
                <button id="polygonBtn" class="tool-btn" title="Poligon">‚ñ≠</button>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4/2.9.2/proj4.js"></script>
    <script src="https://unpkg.com/proj4leaflet@1.0.2/dist/proj4leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

    <script type="module">
        const consoleDiv = document.getElementById('console');

        function log(msg, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'log error' : 'log';
            div.textContent = `[${new Date().toTimeString().split(' ')[0]}] ${msg}`;
            consoleDiv.appendChild(div);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(msg);
        }

        async function initApp() {
            try {
                log('üöÄ Starting simple test app...');

                // Wait for libraries
                await new Promise((resolve) => {
                    const check = () => {
                        if (window.L && window.L.Draw && window.proj4) {
                            resolve();
                        } else {
                            setTimeout(check, 50);
                        }
                    };
                    check();
                });
                log('‚úÖ External libraries loaded');

                // Import core modules (without database)
                log('üì¶ Importing core modules...');
                const { initializeMap, createDrawnItemsLayer } = await import('/modules/core/map.js');
                log('‚úÖ Core modules loaded');

                // Initialize map
                log('üó∫Ô∏è Initializing map...');
                window.map = initializeMap('map');
                window.drawnItems = createDrawnItemsLayer(window.map);
                log('‚úÖ Map initialized');

                // Setup draw control
                log('‚úèÔ∏è Setting up drawing controls...');
                window.drawControl = new L.Control.Draw({
                    draw: {
                        polyline: true,
                        polygon: true,
                        marker: true,
                        rectangle: true,
                        circle: true,
                        circlemarker: false
                    },
                    edit: {
                        featureGroup: window.drawnItems,
                        remove: true
                    }
                });
                window.map.addControl(window.drawControl);
                log('‚úÖ Drawing controls ready');

                // Setup draw events
                window.map.on(L.Draw.Event.CREATED, function (event) {
                    const layer = event.layer;
                    window.drawnItems.addLayer(layer);
                    log(`‚úÖ Feature created: ${event.layerType}`);
                });

                log('‚úÖ‚úÖ‚úÖ Application initialized successfully! ‚úÖ‚úÖ‚úÖ');
                log('Map should be visible below');

            } catch (error) {
                log(`‚ùå ERROR: ${error.message}`, true);
                log(`Stack: ${error.stack}`, true);
                console.error(error);
            }
        }

        window.testMap = () => {
            if (window.map) {
                log('‚úÖ Map exists!');
                log(`Zoom: ${window.map.getZoom()}, Center: ${window.map.getCenter()}`);
                window.map.setView([39.9334, 32.8597], 8);
            } else {
                log('‚ùå Map not initialized', true);
            }
        };

        window.testDrawing = () => {
            if (window.drawControl) {
                log('‚úÖ Draw control exists!');
                const markerTool = window.drawControl._toolbars.draw._modes.marker;
                if (markerTool && markerTool.handler) {
                    markerTool.handler.enable();
                    log('‚úÖ Marker drawing enabled');
                } else {
                    log('‚ùå Marker tool not found', true);
                }
            } else {
                log('‚ùå Draw control not initialized', true);
            }
        };

        // Start the app
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
