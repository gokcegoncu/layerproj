<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple App Test</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="/styles/main.css">

  <style>
    #console {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 10000;
      border: 2px solid #00ff00;
    }
    .log { margin: 2px 0; }
    .error { color: #ff0000; }
  </style>
</head>
<body>
    <div id="console"></div>
    <div class="main-container">
        <div class="layer-panel">
            <div class="panel-header">
                <h2>üó∫Ô∏è Simple Test (No Database)</h2>
            </div>
            <div class="create-buttons" style="display: flex; flex-direction: column; gap: 10px;">
                <button onclick="createDemoData()" style="padding: 15px; font-size: 16px; font-weight: bold;">
                    üé≤ 1. Create Demo Data (50 points)
                </button>
                <button onclick="createHeatmap()" style="padding: 15px; font-size: 16px; font-weight: bold; background: linear-gradient(135deg, #ff6b6b, #ee5a6f);">
                    üî• 2. Create Heatmap
                </button>
                <button onclick="removeHeatmap()" style="padding: 10px; font-size: 14px;">
                    ‚ùå 3. Remove Heatmap
                </button>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <script>
        const consoleDiv = document.getElementById('console');

        function log(msg, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'log error' : 'log';
            div.textContent = `[${new Date().toTimeString().split(' ')[0]}] ${msg}`;
            consoleDiv.appendChild(div);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(msg);
        }

        async function initApp() {
            try {
                log('üöÄ Starting simple test app...');

                // Wait for libraries
                await new Promise((resolve) => {
                    const check = () => {
                        if (window.L && window.L.heatLayer) {
                            resolve();
                        } else {
                            setTimeout(check, 50);
                        }
                    };
                    check();
                });
                log('‚úÖ External libraries loaded (Leaflet + Leaflet.heat)');

                // Initialize map directly (no module imports)
                log('üó∫Ô∏è Initializing map...');
                window.map = L.map('map').setView([39.9334, 32.8597], 6);

                // Add OpenStreetMap tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(window.map);

                log('‚úÖ Map initialized');

                // Create feature group for drawn items
                window.drawnItems = new L.FeatureGroup();
                window.map.addLayer(window.drawnItems);
                log('‚úÖ Feature group created');

                log('‚úÖ‚úÖ‚úÖ Application initialized successfully! ‚úÖ‚úÖ‚úÖ');
                log('üé≤ Click "Create Demo Data" to start!');

            } catch (error) {
                log(`‚ùå ERROR: ${error.message}`, true);
                log(`Stack: ${error.stack}`, true);
                console.error(error);
            }
        }

        // Demo data storage
        window.demoPoints = [];
        window.heatmapLayer = null;

        window.createDemoData = () => {
            log('üé≤ Creating demo data...');

            // Clear existing demo points
            window.demoPoints = [];
            window.drawnItems.clearLayers();

            // Ankara center
            const center = [39.9334, 32.8597];
            const pointCount = 50;

            // Create random points around Ankara
            for (let i = 0; i < pointCount; i++) {
                // Random offset (about 0.1 degrees = ~11km)
                const lat = center[0] + (Math.random() - 0.5) * 0.2;
                const lng = center[1] + (Math.random() - 0.5) * 0.2;

                // Random value (1-100)
                const value = Math.floor(Math.random() * 100) + 1;

                // Create marker
                const marker = L.circleMarker([lat, lng], {
                    radius: 6,
                    fillColor: '#3388ff',
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.6
                });

                // Add to map
                marker.addTo(window.drawnItems);

                // Bind popup with value
                marker.bindPopup(`Value: ${value}`);

                // Store point data
                window.demoPoints.push({
                    lat: lat,
                    lng: lng,
                    value: value,
                    marker: marker
                });
            }

            // Zoom to bounds
            if (window.drawnItems.getLayers().length > 0) {
                window.map.fitBounds(window.drawnItems.getBounds(), { padding: [50, 50] });
            }

            log(`‚úÖ Created ${pointCount} demo points with random values (1-100)`);
            log('üìä Min value: ' + Math.min(...window.demoPoints.map(p => p.value)));
            log('üìä Max value: ' + Math.max(...window.demoPoints.map(p => p.value)));
        };

        window.createHeatmap = () => {
            if (window.demoPoints.length === 0) {
                log('‚ùå No demo data! Click "Create Demo Data" first.', true);
                return;
            }

            log('üî• Creating heatmap...');

            // Remove old heatmap
            if (window.heatmapLayer) {
                window.map.removeLayer(window.heatmapLayer);
                log('üóëÔ∏è Removed old heatmap');
            }

            // Check if leaflet.heat is loaded
            if (typeof L.heatLayer === 'undefined') {
                log('‚ùå Leaflet.heat not loaded!', true);
                return;
            }

            // Prepare data: [lat, lng, intensity]
            const heatData = window.demoPoints.map(p => [p.lat, p.lng, p.value]);

            log(`üìä Heatmap data prepared: ${heatData.length} points`);

            // Create heatmap
            window.heatmapLayer = L.heatLayer(heatData, {
                radius: 40,
                blur: 30,
                maxZoom: 17,
                max: Math.max(...window.demoPoints.map(p => p.value)),
                gradient: {
                    0.0: 'blue',
                    0.2: 'cyan',
                    0.4: 'lime',
                    0.6: 'yellow',
                    0.8: 'orange',
                    1.0: 'red'
                }
            });

            // Add to map
            window.heatmapLayer.addTo(window.map);

            log('‚úÖ Heatmap created successfully!');
            log('üî• Radius: 40px, Blur: 30px');
            log('üåà Gradient: Blue ‚Üí Cyan ‚Üí Lime ‚Üí Yellow ‚Üí Orange ‚Üí Red');
        };

        window.removeHeatmap = () => {
            if (window.heatmapLayer) {
                window.map.removeLayer(window.heatmapLayer);
                window.heatmapLayer = null;
                log('‚úÖ Heatmap removed');
            } else {
                log('‚ö†Ô∏è No heatmap to remove');
            }
        };

        // Start the app
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
